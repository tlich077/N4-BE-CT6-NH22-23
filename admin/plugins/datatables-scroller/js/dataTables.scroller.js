s.gr,workenter.gr,argesulonline.ro,dotyk.cz,anorthosis24.net,lahrer-zeitung.de,verlagshaus-jaumann.de,kornwestheimer-zeitung.de,leonberger-kreiszeitung.de,szbz.de,bbheute.de,krzbb.de,bietigheimerzeitung.de,zvw.de,muehlacker-tagblatt.de,extrasport.net,spokojenezeny.cz,mila.bg,stuttgarter-nachrichten.de,stuttgarter-zeitung.de,schwarzwaelder-bote.de,frankenpost.de,np-coburg.de,insuedthueringen.de,esslinger-zeitung.de,cannstatter-zeitung.de,marbacher-zeitung.d,shamlola.com,gololy.com,athensvoice.gr,protv.ro,asibiliou.gr,sports.fr,businessonline.it,tenhomaisdiscosqueamigos.com,nowtolove.com.au,gourmettraveller.com.au,who.com.au,womenshealthmag.com,ratingcero.com,folk-media.com,myweather2.com,exxpress.at,live.joins.com,pcgameshardware.de,quever.news,jol-jam.com,canal1.com.co,tipgalore.com,asianetnews.com,enca.com,radioradio.it,nameslook.com,lhistoire.fr,francelive.fr,tvguidetime.com,funpot.net,digistatement.com,manilatonight.com,laregion.es,annuaire-inverse-france.com,asibiliou.gr,karditsalive.net,telugu.gizbot.com,paperblog.fr,saturdaytradition.com,quizur.com,meridiano.net,xeu.mx,frequence-turf.fr,alyaoum24.com,afriquesports.net,conselhosetruques.com,kalerkantho.com,brighttv.co.th,parati.com.ar,gente.com.ar,nyheder24.dk,kwejk.pl,zoomtventertainment.com,calculadoraconversor.com,fansportu.pl,fumettologica.it,viralpressen.se,protv.ro,justcookwell.com,cricketaddictor.com,vorschauxxl.de,folha.uol.com.br,sheknows.com,stylecaster.com,otempo.com.br,menorca.info,sic.pt,lagacetadesalamanca.es,cifras.com.br,radiosonline.cl,mognavi.jp,diariodeburgos.es,citybuzz.pl,torrinomedica.it,humanite.fr,news.infoseek.co.jp,aubtu.biz,ballgametime.com,linkvill.com,bangkokpost.com,mundopositivo.com.br,alcalorpolitico.com,elcontribuyente.mx,noticiasagricolas.com.br,bnews.com.br,hotnews.ro,soaps.sheknows.com,mmorpgbr.com.br,paparazzi.com.ar,article.auone.jp,chinesenews.net.au,telugu.boldsky.com,drivespark.com,hidoc.co.kr,klix.ba,theindependent.sg,bancodeseries.com.br,ricettafitness.com,significadoconcepto.com,folhape.com.br,bibliatodo.com,bemparana.com.br,conjur.com.br,leprogres.fr,lainformacion.com,thethaiger.com,worldjournal.com,utaten.com,promiflash.de,myessentielles.fr,memki.pl,sn-jp.com,elpatagonico.com,thedirect.com,break-time.net,ultimahora.es,diariodenavarra.es,rybnik.com.pl,kurer-sreda.ru,e-chords.com,newschant.com,seccionamarilla.com.mx,drivespark.com,koimoi.com,marieclaire.com.au,runnersworld.com,report24.news,ldplayer.net,timeslive.co.za,timeout.co.il,atmag.co.il,weatherzone.com.au,baanlaesuan.com,kormedi.com,ligaportal.at,tvhistoria.com.br,yourdictionary.com,4players.de,intrld.com,justquiz.com,descubraonline.com,tododisca.com,labrujula24.com,lactucitoyenne.fr,islandecho.co.uk,lasanteauquotidien.com,chinesenews.net.au,spieltimes.com,tellygossips.net,rumorpix.com,dallasnews.com,pix-geeks.com,metroecuador.com.ec,pi.biishiki-lab.com,acordacidade.com.br,sol.sapo.pt,ionline.sapo.pt,soccer-king.jp,ocnamuresinfo.ro,quizchef.gr,vibefm.ro,campeniinfo.ro,teiusinfo.ro,kidsofkosova.net,joaobidu.com.br,b1tv.ro,eretikos.gr,clickpentrufemei.ro,oranews.tv,ant1.com.cy,kuwaitlocal.com,newspascani.com,insajderi.org,sputniknewslv.com,inspiredot.net,sputniknews.lt,sputnik-tj.com,loonapix.com,zoldujsag.hu,gamer.hu,ledauphine.com,atlasobscura.com,leetesport.hu,66n.com,voxcatch.fr,classlifestyle.com,arablocal.com,waaboom.com,dna.fr,izeselet.hu,russian7.ru,cyrillitsa.ru,tstosterone.ru,umnaja.ru,nbcsportsedge.com,calcalist.co.il,calcalistech.com,diariotextual.com,eldiario.es,chugoku-np.co.jp,happy-woman.com,nationalheraldindia.com,dailythanthi.com,conservativewoman.co.uk,hankyung.com,sowetanlive.co.za,xristika.gr,gizmochina.com,siasat.com,viralgust.com,bhg.com.au,newidea.com.au,amongus-online.net,kraloyun.com,bienpublic.com,republicain-lorrain.fr,vosgesmatin.fr,estrepublicain.fr,lejsl.com,glasul-hd.ro,sohu.com,goodreturns.in,librarius.hu,immonot.com,lalanguefrancaise.com,lalsace.fr,dailian.co.kr,russian7.ru,cyrillitsa.ru,jeuxvideo-live.com,hani.co.kr,oneindia.com,filmibeat.com,myfreegames.net,mykhel.com,digitalspy.com,cosmopolitan.com,menshealth.com,volcanodiscovery.com,alexia.fr,ntnews.com,chefsimon.com,zackzack.at,koreadaily.com,olive-hitomawashi.com,onvideo.hu,pontosnews.gr,koncertblog.hu,meilleurpronostic.com,sportsmonks.com,the-wau.com,omanday.com,blog.q-tickets.com,marhabasaudi.com,nayrouz.com,kerkida.net,jovempan.com.br,consejosytrucos.co,ahaber.com.tr,newsmondo.it,primochef.it,forum.over.net,allguiderecipes.info,motorimagazine.it,faz.net,ladylike.gr,news247.gr,oneman.gr,drivemebaby.hu,vidhome.club,dumazahrada.cz,storymag.cz,botrini.gr,sarahanews.net,ardeal24.ro,primeiroasaber.com.br,policenews.eu,hellomama.com.cy,onlymen.cz,tvfreaks.gr,onlyu.cz,contra.gr,aqartalk.com,theunionjournal.com,hobi.ba,glance.gr,vp-news.com,arabiaweather.com,agoravale.com.br,enfemenino.com,alfemminile.com,lesnumeriques.com,doctissimo.fr,marmiton.org,cnetfrance.fr,zdnet.fr,gamekult.com,tube-ranker.net,linkfang.org,in4tong.com,webnovelonline.com,stuff.tv,housinglover.com,zerozero.pt,pr0gramm.com,iagua.es,footballitarin.com,mb.com.ph,hogarmania.com,kurashi-no.jp,nakkheeran.in,camperonline.it,blagues-et-dessins.com,moviechat.org,portalfalanordeste.com,hojeemdia.com.br,automarket.ro,photografix-magazin.de,iltirreno.gelocal.it,puntodebreak.com,autoby.jp,elprogreso.es,financial10.com,bella.tw,wealth.com.tw,hotpoptoday.com,wundaba.de,mty.telediario.mx,yourdailysportfix.com,65ymas.com,paris-normandie.fr,denik.cz,oblikon.net,mila.bg,mama24.bg,eva.ro,liguedesofficiersdetatcivil.fr,nipponconnection.fr,fress.co,africanews.com,leshommesmodernes.com,thebullybreeds.com,tohotweb.com,danified.com,tafeio.tv,sizzlingfeed.com,mesastuces.fr,testonsensemble.com,stylerange.com,objetconnecte.net,billetdebanque.panorabanques.com,wissenswert.co,iphonea2.com,theartikulounonews.com,lajmifundit.al,soutaoboa.com,geiletore.de,abiyamo.com,runningmania.net,francescaleto.com,buzz-days.com,twinbuzz.com,rootschat.com,vaartha.com,nmk.co.in,mirrorcreator.com,footpy.fr,jamenage.fr,horoscopes.co.uk,all-musculation.com,santesos.com,zbawienie.forumotion.com,11v11.com,1fichier.com,alunosonline.uol.com.br,anglia.today,areah.com.br,badtameezdil.net,bequizz.com,bigbangnews.com,bollywoodbliss.com,bostonmagazine.com,brasilescola.uol.com.br,bucatarici.ro,bust.com,buzzhand.com,cabaneaidees.com,calankamedia.com,combien-coute.net,consequenceofsound.net,critictoo.com,culture-generale.fr,cyclingpro.net,departed.co,desporto365.com,dicionarioinformal.com.br,epaper.ntnews.com,epicstream.com,exercicios.mundoeducacao.bol.uol.com.br,facts.ge,financebuzz.io,fluentland.com,forums.thebump.com,fraaviation.forumsfree.de,funnz.nl,gamezup.com,griffinsguide.com,guidatorino.com,happies.fr,hiilkubad.com,hitparades.fr,hockeyhebdo.com,holidogtimes.com,horoscopefriends.co.uk,hotcelebshome.com,hotsheet.com,indialivetoday.com,indiosrojiblancos.net,it.ubergizmo.com,lematindz.net,lesjoiesducode.fr,levelup.com,lifeder.com,logicalbharat.com,madamebuzz.com,mamma.dev-effectivity.pl,mamul.am,manoramanews.com,militarybases.com,mindblowingvideos.com,movienewsguide.com,myinforms.com,nature.skytopic.org,nbamixes.com,nouveautes-tele.com,opozita.com,phillymag.com,planetradiocity.com,politicsweb.co.za,prabhanews.com,psbeyond.com,quecomico.com,quizionaire.com,raceyourlife.it,racingdudes.com,rechingon.com,recombu.com,renewcanceltv.com,routeyou.com,runirusnarod.forum2x2.ru,science.blurtit.com,shqiperiaime.al,slimness.fr,souportista.pt,southendnewsnetwork.com,sportressofblogitude.com,sportwitness.co.uk,tabooya.com,tattoo-spirit.de,termdates.co.uk,thebaseballcube.com,topday.com,trendtitan.com,trolino.com,tv-subs.com,ujyaaloonline.com,unsurcoenlasombra.com,usefultipsforhome.com,vrancea24.ro,warpedwales.co.uk,weqyoua.net,wideopenspaces.com,winpoin.com,wouldyourather.co.uk,zinezaz.com,zmonline.com,thestranger.com,sanantonio.culturemap.com,thinkhealthier.com,sports-reference.com,danscourses.com,quizzzat.net,rockfeed.net,techhelpkb.com,moto-net.com,leadertelegram.com,elblog.com,foodio54.com,chch.com,savingadvice.com,myhoneysplace.com,restaurantmealprices.com,realitywives.net,0-60specs.com,gymmembershipfees.com,victoriaadvocate.com,onlysp.com,russellstreetreport.com,kid101.com,tvduck.com,conference©Æ¹ùcalltranscripts.org,columbiatribune.com,fanpagelist.com,forums.digitalpoint.com,vancouverisawesome.com,zerocensorship.com,gayety.co,rellenadodecartuchos.com,appamatix.com,foodporndaily.com,jaynestars.com,fitnessrepublic.com,simplehelp.net,steelersdepot.com,tfetimes.com,nhltraderumors.me,jamaica-star.com,elevenwarriors.com,connectsavannah.com,thefifthflavor.com,forums.techguy.org,mundoconsejos.com,cordcuttersnews.com,pasionaguila.com,iamatexan.com,significadosbr.com.br,periodismo.com,99scenes.com,welikela.com,newsbusters.org,sonhos.com.br,theybf.com,whiskeyriff.com,capegazette.com,stgeorgeutah.com,idealistrevolution.org,thebark.com,linuxbsdos.com,youmobile.org,freeappgg.com,sneakerbardetroit.com,tomatazos.com,ixdaily.com,puppylovernews.com,comicbookroundup.com,recetasparaadelgazar.com,cdanews.com,nationalfootballpost.com,wideopencountry.com,iphoneate.com,paris-supporters.fr,earth911.com,sportsnaut.com,heaviermetal.net,bilerico.com,altpress.com,theinertia.com,rsvlts.com,appletoolbox.com,bravewords.com,omachoalpha.com.br,democraticunderground.com,onlysimchas.com,laacibnet.net,tamilstar.com,weatherbase.com,notasdemascotas.com,runwayriot.com,se80.co.uk,comidakraft.com,yosoyungamer.com,newsexaminer.net,relativelyinteresting.com,theculture.forharriet.com,oilerhockey.com,exstreamist.com,wideopenpets.com,alternativli.co.il,amicohoops.net,amny.com,androidauthority.com,annistonstar.com,astucesdegrandmere.net,bcrnews.com,bestappsforkids.com,bgdailynews.com,bloghogar.net,buildconstructpros.com,cityapplications.com,cloudpix.co,coladaweb.com,crowdfundinsider.com,cuidadosdetusalud.com,daily-chronicle.com,daily-jeff.com,dayhot.news,de.soccerway.com,defensacentral.com,definiciona.com,ecocosas.com,elmanana.com,es.soccerway.com,ethsat.com,eveningexpress.co.uk,fr.soccerway.com,fredericknewspost.com,fun01.net,geargods.net,generationiron.com,heraldmailmedia.com,heraldtimesonline.com,historicmysteries.com,homemodelenginemachinist.com,idotaketwo.com,indiawest.com,ipl.cricket.com.pk,kcchronicle.com,kelownadailycourier.ca,kitchenknifeforums.com,knbr.com,knicksitalia.forumattivo.it,kpvi.com,kurupira.net,laliste.net,lambgoat.com,laopinion.com.co,larecette.net,lyricsted.com,mensagenscomamor.com,metalinsider.net,miaou.club,misterios.co,mlbstartingnine.com,mohavedailynews.com,muitofranca.com.br,mysuburbanlife.com,ndinsider.com,nl.soccerway.com,notitotal.com,observer-reporter.com,otvfoco.com.br,ovo.kyodo.co.jp,petoskeynews.com,phillytrib.com,portlandmercury.com,pride.com,profootballweekly.com,pt.soccerway.com,quotedb.com,rawapk.com,recordpub.com,ro.soccerway.com,rocketryforum.com,saludhogar.net,saludnat.com,saukvalley.com,sciencepost.fr,shesahomewrecker.com,soapmakingforum.com,southbendtribune.com,starlocalmedia.com,supercars.net,tailfeathersnetwork.com,tech.co,the-daily-record.com,thedailymail.net,thedailytimes.com,theherald-news.com,theintellectualist.co,theiphonemom.com,theprp.com,thewalkingdead.com.br,times-gazette.com,tmnews.com,topinfos.fr,topweddingsites.com,tupaki.com,turkish-football.com,tusaludesvida.com,union-bulletin.com,updato.com,vegkitchen.com,vidsor.net,voiturebelgique.com,wataugademocrat.com,womenrich.com,wthr.com,wyomingnews.com,yumasun.com,historum.com,meutimao.com.br,hypedojo.com,bilan-imc.fr,utube.com,visordown.com,crash.net,2016presidentialdebateschedule.com,uspresidentialelectionnews.com,urtech.ca,astuces-grand-mere.fr,diabeticnewsnow.com,thecount.com,memeguy.com,topfive.it,therams.com,kittylovernews.com,apestan.com,info-halal.net,elsoldepuebla.com.mx,firehouse.com,officer.com,securityinfowatch.com,locksmithledger.com,knox.villagesoup.com,waldo.villagesoup.com,gujarati.webdunia.com,telugu.webdunia.com,tamil.webdunia.com,malayalam.webdunia.com,kannada.webdunia.com,marathi.webdunia.com,dayspot.net,dailyfun.cc,ireaded.com,share01.cc,post01.com,br.blastingnews.com,it.blastingnews.com,kbagi.com,info-carros.com,tecnofinanzas.net,bikesportnews.com,motomagazine.co.uk,golfmagic.com,trend-chaser.com,hooch.net,viralpiranha.com,techinsider.io,lifedaily.com,mflaire.com,cdtl.fr,alsocomedy.com,eluniversal.com.mx,gameblog.fr,potins.net,vieroller).scrollTop( px );
		}
	},


	/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
	 * Constructor
	 */

	/**
	 * Initialisation for Scroller
	 *  @returns {void}
	 *  @private
	 */
	construct: function ()
	{
		var that = this;
		var dt = this.s.dtApi;

		/* Sanity check */
		if ( !this.s.dt.oFeatures.bPaginate ) {
			this.s.dt.oApi._fnLog( this.s.dt, 0, 'Pagination must be enabled for Scroller' );
			return;
		}

		/* Insert a div element that we can use to force the DT scrolling container to
		 * the height that would be required if the whole table was being displayed
		 */
		this.dom.force.style.position = "relative";
		this.dom.force.style.top = "0px";
		this.dom.force.style.left = "0px";
		this.dom.force.style.width = "1px";

		this.dom.scroller = $('div.'+this.s.dt.oClasses.sScrollBody, this.s.dt.nTableWrapper)[0];
		this.dom.scroller.appendChild( this.dom.force );
		this.dom.scroller.style.position = "relative";

		this.dom.table = $('>table', this.dom.scroller)[0];
		this.dom.table.style.position = "absolute";
		this.dom.table.style.top = "0px";
		this.dom.table.style.left = "0px";

		// Add class to 'announce' that we are a Scroller table
		$(dt.table().container()).addClass('dts DTS');

		// Add a 'loading' indicator
		if ( this.s.loadingIndicator )
		{
			this.dom.loader = $('<div class="dataTables_processing dts_loading">'+this.s.dt.oLanguage.sLoadingRecords+'</div>')
				.css('display', 'none');

			$(this.dom.scroller.parentNode)
				.css('position', 'relative')
				.append( this.dom.loader );
		}

		this.dom.label.appendTo(this.dom.scroller);

		/* Initial size calculations */
		if ( this.s.heights.row && this.s.heights.row != 'auto' )
		{
			this.s.autoHeight = false;
		}

		// Scrolling callback to see if a page change is needed
		this.s.ingnoreScroll = true;
		$(this.dom.scroller).on( 'scroll.dt-scroller', function (e) {
			that._scroll.call( that );
		} );

		// In iOS we catch the touchstart event in case the user tries to scroll
		// while the display is already scrolling
		$(this.dom.scroller).on('touchstart.dt-scroller', function () {
			that._scroll.call( that );
		} );

		$(this.dom.scroller)
			.on('mousedown.dt-scroller', function () {
				that.s.mousedown = true;
			})
			.on('mouseup.dt-scroller', function () {
				that.s.labelVisible = false;
				that.s.mousedown = false;
				that.dom.label.css('display', 'none');
			});

		// On resize, update the information element, since the number of rows shown might change
		$(window).on( 'resize.dt-scroller', function () {
			that.measure( false );
			that._info();
		} );

		// Add a state saving parameter to the DT state saving so we can restore the exact
		// position of the scrolling.
		var initialStateSave = true;
		var loadedState = dt.state.loaded();

		dt.on( 'stateSaveParams.scroller', function ( e, settings, data ) {
			if ( initialStateSave && loadedState ) {
				data.scroller = loadedState.scroller;
				initialStateSave = false;
			}
			else {
				// Need to used the saved position on init
				data.scroller = {
					topRow: that.s.topRowFloat,
					baseScrollTop: that.s.baseScrollTop,
					baseRowTop: that.s.baseRowTop,
					scrollTop: that.s.lastScrollTop
				};
			}
		} );

		if ( loadedState && loadedState.scroller ) {
			this.s.topRowFloat = loadedState.scroller.topRow;
			this.s.baseScrollTop = loadedState.scroller.baseScrollTop;
			this.s.baseRowTop = loadedState.scroller.baseRowTop;
		}

		this.measure( false );
	
		that.s.stateSaveThrottle = that.s.dt.oApi._fnThrottle( function () {
			that.s.dtApi.state.save();
		}, 500 );

		dt.on( 'init.scroller', function () {
			that.measure( false );

			// Setting to `jump` will instruct _draw to calculate the scroll top
			// position
			that.s.scrollType = 'jump';
			that._draw();

			// Update the scroller when the DataTable is redrawn
			dt.on( 'draw.scroller', function () {
				that._draw();
			});
		} );

		// Set height before the draw happens, allowing everything else to update
		// on draw complete without worry for roder.
		dt.on( 'preDraw.dt.scroller', function () {
			that._scrollForce();
		} );

		// Destructor
		dt.on( 'destroy.scroller', function () {
			$(window).off( 'resize.dt-scroller' );
			$(that.dom.scroller).off('.dt-scroller');
			$(that.s.dt.nTable).off( '.scroller' );

			$(that.s.dt.nTableWrapper).removeClass('DTS');
			$('div.DTS_Loading', that.dom.scroller.parentNode).remove();

			that.dom.table.style.position = "";
			that.dom.table.style.top = "";
			that.dom.table.style.left = "";
		} );
	},


	/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
	 * Private methods
	 */

	/**
	 * Automatic calculation of table row height. This is just a little tricky here as using
	 * initialisation DataTables has tale the table out of the document, so we need to create
	 * a new table and insert it into the document, calculate the row height and then whip the
	 * table out.
	 *  @returns {void}
	 *  @private
	 */
	_calcRowHeight: function ()
	{
		var dt = this.s.dt;
		var origTable = dt.nTable;
		var nTable = origTable.cloneNode( false );
		var tbody = $('<tbody/>').appendTo( nTable );
		var container = $(
			'<div class="'+dt.oClasses.sWrapper+' DTS">'+
				'<div class="'+dt.oClasses.sScrollWrapper+'">'+
					'<div class="'+dt.oClasses.sScrollBody+'"></div>'+
				'</div>'+
			'</div>'
		);

		// Want 3 rows in the sizing table so :first-child and :last-child
		// CSS styles don't come into play - take the size of the middle row
		$('tbody tr:lt(4)', origTable).clone().appendTo( tbody );
        var rowsCount = $('tr', tbody).length;

        if ( rowsCount === 1 ) {
            tbody.prepend('<tr><td>&#160;</td></tr>');
            tbody.append('<tr><td>&#160;</td></tr>');
		}
		else {
            for (; rowsCount < 3; rowsCount++) {
                tbody.append('<tr><td>&#160;</td></tr>');
            }
		}
	
		$('div.'+dt.oClasses.sScrollBody, container).append( nTable );

		// If initialised using `dom`, use the holding element as the insert point
		var insertEl = this.s.dt.nHolding || origTable.parentNode;

		if ( ! $(insertEl).is(':visible') ) {
			insertEl = 'body';
		}

		// Remove form element links as they might select over others (particularly radio and checkboxes)
		container.find("input").removeAttr("name");

		container.appendTo( insertEl );
		this.s.heights.row = $('tr', tbody).eq(1).outerHeight();

		container.remove();
	},

	/**
	 * Draw callback function which is fired when the DataTable is redrawn. The main function of
	 * this method is to position the drawn table correctly the scrolling container for the rows
	 * that is displays as a result of the scrolling position.
	 *  @returns {void}
	 *  @private
	 */
	_draw: function ()
	{
		var
			that = this,
			heights = this.s.heights,
			iScrollTop = this.dom.scroller.scrollTop,
			iTableHeight = $(this.s.dt.nTable).height(),
			displayStart = this.s.dt._iDisplayStart,
			displayLen = this.s.dt._iDisplayLength,
			displayEnd = this.s.dt.fnRecordsDisplay();

		// Disable the scroll event listener while we are updating the DOM
		this.s.skip = true;

		// If paging is reset
		if ( (this.s.dt.bSorted || this.s.dt.bFiltered) && displayStart === 0 && !this.s.dt._drawHold ) {
			this.s.topRowFloat = 0;
		}

		iScrollTop = this.s.scrollType === 'jump' ?
			this._domain( 'virtualToPhysical', this.s.topRowFloat * heights.row ) :
			iScrollTop;

		// Store positional information so positional calculations can be based
		// upon the current table draw position
		this.s.baseScrollTop = iScrollTop;
		this.s.baseRowTop = this.s.topRowFloat;

		// Position the table in the virtual scroller
		var tableTop = iScrollTop - ((this.s.topRowFloat - displayStart) * heights.row);
		if ( displayStart === 0 ) {
			tableTop = 0;
		}
		else if ( displayStart + displayLen >= displayEnd ) {
			tableTop = heights.scroll - iTableHeight;
		}

		this.dom.table.style.top = tableTop+'px';

		/* Cache some information for the scroller */
		this.s.tableTop = tableTop;
		this.s.tableBottom = iTableHeight + this.s.tableTop;

		// Calculate the boundaries for where a redraw will be triggered by the
		// scroll event listener
		var boundaryPx = (iScrollTop - this.s.tableTop) * this.s.boundaryScale;
		this.s.redrawTop = iScrollTop - boundaryPx;
		this.s.redrawBottom = iScrollTop + boundaryPx > heights.scroll - heights.viewport - heights.row ?
			heights.scroll - heights.viewport - heights.row :
			iScrollTop + boundaryPx;

		this.s.skip = false;

		// Restore the scrolling position that was saved by DataTable's state
		// saving Note that this is done on the second draw when data is Ajax
		// sourced, and the first draw when DOM soured
		if ( this.s.dt.oFeatures.bStateSave && this.s.dt.oLoadedState !== null &&
			 typeof this.s.dt.oLoadedState.scroller != 'undefined' )
		{
			// A quirk of DataTables is that the draw callback will occur on an
			// empty set if Ajax sourced, but not if server-side processing.
			var ajaxSourced = (this.s.dt.sAjaxSource || that.s.dt.ajax) && ! this.s.dt.oFeatures.bServerSide ?
				true :
				false;

			if ( ( ajaxSourced && this.s.dt.iDraw == 2) ||
			     (!ajaxSourced && this.s.dt.iDraw == 1) )
			{
				setTimeout( function () {
					$(that.dom.scroller).scrollTop( that.s.dt.oLoadedState.scroller.scrollTop );

					// In order to prevent layout thrashing we need another
					// small delay
					setTimeout( function () {
						that.s.ingnoreScroll = false;
					}, 0 );
				}, 0 );
			}
		}
		else {
			that.s.ingnoreScroll = false;
		}

		// Because of the order of the DT callbacks, the info update will
		// take precedence over the one we want here. So a 'thread' break is
		// needed.  Only add the thread break if bInfo is set
		if ( this.s.dt.oFeatures.bInfo ) {
			setTimeout( function () {
				that._info.call( that );
			}, 0 );
		}

		// Hide the loading indicator
		if ( this.dom.loader && this.s.loaderVisible ) {
			this.dom.loader.css( 'display', 'none' );
			this.s.loaderVisible = false;
		}
	},

	/**
	 * Convert from one domain to another. The physical domain is the actual
	 * pixel count on the screen, while the virtual is if we had browsers which
	 * had scrolling containers of infinite height (i.e. the absolute value)
	 *
	 *  @param {string} dir Domain transform direction, `virtualToPhysical` or
	 *    `physicalToVirtual` 
	 *  @returns {number} Calculated transform
	 *  @private
	 */
	_domain: function ( dir, val )
	{
		var heights = this.s.heights;
		var diff;
		var magic = 10000; // the point at which the non-linear calculations start to happen

		// If the virtual and physical height match, then we use a linear
		// transform between the two, allowing the scrollbar to be linear
		if ( heights.virtual === heights.scroll ) {
			return val;
		}

		// In the first 10k pixels and the last 10k pixels, we want the scrolling
		// to be linear. After that it can be non-linear. It would be unusual for
		// anyone to mouse wheel through that much.
		if ( val < magic ) {
			return val;
		}
		else if ( dir === 'virtualToPhysical' && val >= heights.virtual - magic ) {
			diff = heights.virtual - val;
			return heights.scroll - diff;
		}
		else if ( dir === 'physicalToVirtual' && val >= heights.scroll - magic ) {
			diff = heights.scroll - val;
			return heights.virtual - diff;
		}

		// Otherwise, we want a non-linear scrollbar to take account of the
		// redrawing regions at the start and end of the table, otherwise these
		// can stutter badly - on large tables 30px (for example) scroll might
		// be hundreds of rows, so the table would be redrawing every few px at
		// the start and end. Use a simple linear eq. to stop this, effectively
		// causing a kink in the scrolling ratio. It does mean the scrollbar is
		// non-linear, but with such massive data sets, the scrollbar is going
		// to be a best guess anyway
		var m = (heights.virtual - magic - magic) / (heights.scroll - magic - magic);
		var c = magic - (m*magic);

		return dir === 'virtualToPhysical' ?
			(val-c) / m :
			(m*val) + c;
	},

	/**
	 * Update any information elements that are controlled by the DataTable based on the scrolling
	 * viewport and what rows are visible in it. This function basically acts in the same way as
	 * _fnUpdateInfo in DataTables, and effectively replaces that function.
	 *  @returns {void}
	 *  @private
	 */
	_info: function ()
	{
		if ( !this.s.dt.oFeatures.bInfo )
		{
			return;
		}

		var
			dt = this.s.dt,
			language = dt.oLanguage,
			iScrollTop = this.dom.scroller.scrollTop,
			iStart = Math.floor( this.pixelsToRow(iScrollTop, false, this.s.ani)+1 ),
			iMax = dt.fnRecordsTotal(),
			iTotal = dt.fnRecordsDisplay(),
			iPossibleEnd = Math.ceil( this.pixelsToRow(iScrollTop+this.s.heights.viewport, false, this.s.ani) ),
			iEnd = iTotal < iPossibleEnd ? iTotal : iPossibleEnd,
			sStart = dt.fnFormatNumber( iStart ),
			sEnd = dt.fnFormatNumber( iEnd ),
			sMax = dt.fnFormatNumber( iMax ),
			sTotal = dt.fnFormatNumber( iTotal ),
			sOut;

		if ( dt.fnRecordsDisplay() === 0 &&
			   dt.fnRecordsDisplay() == dt.fnRecordsTotal() )
		{
			/* Empty record set */
			sOut = language.sInfoEmpty+ language.sInfoPostFix;
		}
		else if ( dt.fnRecordsDisplay() === 0 )
		{
			/* Empty record set after filtering */
			sOut = language.sInfoEmpty +' '+
				language.sInfoFiltered.replace('_MAX_', sMax)+
					language.sInfoPostFix;
		}
		else if ( dt.fnRecordsDisplay() == dt.fnRecordsTotal() )
		{
			/* Normal record set */
			sOut = language.sInfo.
					replace('_START_', sStart).
					replace('_END_',   sEnd).
					replace('_MAX_',   sMax).
					replace('_TOTAL_', sTotal)+
				language.sInfoPostFix;
		}
		else
		{
			/* Record set after filtering */
			sOut = language.sInfo.
					replace('_START_', sStart).
					replace('_END_',   sEnd).
					replace('_MAX_',   sMax).
					replace('_TOTAL_', sTotal) +' '+
				language.sInfoFiltered.replace(
					'_MAX_',
					dt.fnFormatNumber(dt.fnRecordsTotal())
				)+
				language.sInfoPostFix;
		}

		var callback = language.fnInfoCallback;
		if ( callback ) {
			sOut = callback.call( dt.oInstance,
				dt, iStart, iEnd, iMax, iTotal, sOut
			);
		}

		var n = dt.aanFeatures.i;
		if ( typeof n != 'undefined' )
		{
			for ( var i=0, iLen=n.length ; i<iLen ; i++ )
			{
				$(n[i]).html( sOut );
			}
		}

		// DT doesn't actually (yet) trigger this event, but it will in future
		$(dt.nTable).triggerHandler( 'info.dt' );
	},

	/**
	 * Parse CSS height property string as number
	 *
	 * An attempt is made to parse the string as a number. Currently supported units are 'px',
	 * 'vh', and 'rem'. 'em' is partially supported; it works as long as the parent element's
	 * font size matches the body element. Zero is returned for unrecognized strings.
	 *  @param {string} cssHeight CSS height property string
	 *  @returns {number} height
	 *  @private
	 */
	_parseHeight: function(cssHeight) {
		var height;
		var matches = /^([+-]?(?:\d+(?:\.\d+)?|\.\d+))(px|em|rem|vh)$/.exec(cssHeight);

		if (matches === null) {
			return 0;
		}

		var value = parseFloat(matches[1]);
		var unit = matches[2];

		if ( unit === 'px' ) {
			height = value;
		}
		else if ( unit === 'vh' ) {
			height = ( value / 100 ) * $(window).height();
		}
		else if ( unit === 'rem' ) {
			height = value * parseFloat($(':root').css('font-size'));
		}
		else if ( unit === 'em' ) {
			height = value * parseFloat($('body').css('font-size'));
		}

		return height ?
			height :
			0;
	},

	/**
	 * Scrolling function - fired whenever the scrolling position is changed.
	 * This method needs to use the stored values to see if the table should be
	 * redrawn as we are moving towards the end of the information that is
	 * currently drawn or not. If needed, then it will redraw the table based on
	 * the new position.
	 *  @returns {void}
	 *  @private
	 */
	_scroll: function ()
	{
		var
			that = this,
			heights = this.s.heights,
			iScrollTop = this.dom.scroller.scrollTop,
			iTopRow;

		if ( this.s.skip ) {
			return;
		}

		if ( this.s.ingnoreScroll ) {
			return;
		}

		if ( iScrollTop === this.s.lastScrollTop ) {
			return;
		}

		/* If the table has been sorted or filtered, then we use the redraw that
		 * DataTables as done, rather than performing our own
		 */
		if ( this.s.dt.bFiltered || this.s.dt.bSorted ) {
			this.s.lastScrollTop = 0;
			return;
		}

		/* Update the table's information display for what is now in the viewport */
		this._info();

		/* We don't want to state save on every scroll event - that's heavy
		 * handed, so use a timeout to update the state saving only when the
		 * scrolling has finished
		 */
		clearTimeout( this.s.stateTO );
		this.s.stateTO = setTimeout( function () {
			that.s.dtApi.state.save();
		}, 250 );

		this.s.scrollType = Math.abs(iScrollTop - this.s.lastScrollTop) > heights.viewport ?
			'jump' :
			'cont';

		this.s.topRowFloat = this.s.scrollType === 'cont' ?
			this.pixelsToRow( iScrollTop, false, false ) :
			this._domain( 'physicalToVirtual', iScrollTop ) / heights.row;

		if ( this.s.topRowFloat < 0 ) {
			this.s.topRowFloat = 0;
		}

		/* Check if the scroll point is outside the trigger boundary which would required
		 * a DataTables redraw
		 */
		if ( this.s.forceReposition || iScrollTop < this.s.redrawTop || iScrollTop > this.s.redrawBottom ) {
			var preRows = Math.ceil( ((this.s.displayBuffer-1)/2) * this.s.viewportRows );

			iTopRow = parseInt(this.s.topRowFloat, 10) - preRows;
			this.s.forceReposition = false;

			if ( iTopRow <= 0 ) {
				/* At the start of the table */
				iTopRow = 0;
			}
			else if ( iTopRow + this.s.dt._iDisplayLength > this.s.dt.fnRecordsDisplay() ) {
				/* At the end of the table */
				iTopRow = this.s.dt.fnRecordsDisplay() - this.s.dt._iDisplayLength;
				if ( iTopRow < 0 ) {
					iTopRow = 0;
				}
			}
			else if ( iTopRow % 2 !== 0 ) {
				// For the row-striping classes (odd/even) we want only to start
				// on evens otherwise the stripes will change between draws and
				// look rubbish
				iTopRow++;
			}

			// Store calcuated value, in case the following condition is not met, but so
			// that the draw function will still use it.
			this.s.targetTop = iTopRow;

			if ( iTopRow != this.s.dt._iDisplayStart ) {
				/* Cache the new table position for quick lookups */
				this.s.tableTop = $(this.s.dt.nTable).offset().top;
				this.s.tableBottom = $(this.s.dt.nTable).height() + this.s.tableTop;

				var draw = function () {
					that.s.dt._iDisplayStart = that.s.targetTop;
					that.s.dt.oApi._fnDraw( that.s.dt );
				};

				/* Do the DataTables redraw based on the calculated start point - note that when
				 * using server-side processing we introduce a small delay to not DoS the server...
				 */
				if ( this.s.dt.oFeatures.bServerSide ) {
					this.s.forceReposition = true;

					clearTimeout( this.s.drawTO );
					this.s.drawTO = setTimeout( draw, this.s.serverWait );
				}
				else {
					draw();
				}

				if ( this.dom.loader && ! this.s.loaderVisible ) {
					this.dom.loader.css( 'display', 'block' );
					this.s.loaderVisible = true;
				}
			}
		}
		else {
			this.s.topRowFloat = this.pixelsToRow( iScrollTop, false, true );
		}

		this.s.lastScrollTop = iScrollTop;
		this.s.stateSaveThrottle();

		if ( this.s.scrollType === 'jump' && this.s.mousedown ) {
			this.s.labelVisible = true;
		}
		if (this.s.labelVisible) {
			this.dom.label
				.html( this.s.dt.fnFormatNumber( parseInt( this.s.topRowFloat, 10 )+1 ) )
				.css( 'top', iScrollTop + (iScrollTop * heights.labelFactor ) )
				.css( 'display', 'block' );
		}
	},

	/**
	 * Force the scrolling container to have height beyond that of just the
	 * table that has been drawn so the user can scroll the whole data set.
	 *
	 * Note that if the calculated required scrolling height exceeds a maximum
	 * value (1 million pixels - hard-coded) the forcing element will be set
	 * only to that maximum value and virtual / physical domain transforms will
	 * be used to allow Scroller to display tables of any number of records.
	 *  @returns {void}
	 *  @private
	 */
	_scrollForce: function ()
	{
		var heights = this.s.heights;
		var max = 1000000;

		heights.virtual = heights.row * this.s.dt.fnRecordsDisplay();
		heights.scroll = heights.virtual;

		if ( heights.scroll > max ) {
			heights.scroll = max;
		}

		// Minimum height so there is always a row visible (the 'no rows found'
		// if reduced to zero filtering)
		this.dom.force.style.height = heights.scroll > this.s.heights.row ?
			heights.scroll+'px' :
			this.s.heights.row+'px';
	}
} );



/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * Statics
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */


/**
 * Scroller default settings for initialisation
 *  @namespace
 *  @name Scroller.defaults
 *  @static
 */
Scroller.defaults = {
	/**
	 * Scroller uses the boundary scaling factor to decide when to redraw the table - which it
	 * typically does before you reach the end of the currently loaded data set (in order to
	 * allow the data to look continuous to a user scrolling through the data). If given as 0
	 * then the table will be redrawn whenever the viewport is scrolled, while 1 would not
	 * redraw the table until the currently loaded data has all been shown. You will want
	 * something in the middle - the default factor of 0.5 is usually suitable.
	 *  @type     float
	 *  @default  0.5
	 *  @static
	 */
	boundaryScale: 0.5,

	/**
	 * The display buffer is what Scroller uses to calculate how many rows it should pre-fetch
	 * for scrolling. Scroller automatically adjusts DataTables' display length to pre-fetch
	 * rows that will be shown in "near scrolling" (i.e. just beyond the current display area).
	 * The value is based upon the number of rows that can be displayed in the viewport (i.e.
	 * a value of 1), and will apply the display range to records before before and after the
	 * current viewport - i.e. a factor of 3 will allow Scroller to pre-fetch 1 viewport's worth
	 * of rows before the current viewport, the current viewport's rows and 1 viewport's worth
	 * of rows after the current viewport. Adjusting this value can be useful for ensuring
	 * smooth scrolling based on your data set.
	 *  @type     int
	 *  @default  7
	 *  @static
	 */
	displayBuffer: 9,

	/**
	 * Show (or not) the loading element in the background of the table. Note that you should
	 * include the dataTables.scroller.css file for this to be displayed correctly.
	 *  @type     boolean
	 *  @default  false
	 *  @static
	 */
	loadingIndicator: false,

	/**
	 * Scroller will attempt to automatically calculate the height of rows for it's internal
	 * calculations. However the height that is used can be overridden using this parameter.
	 *  @type     int|string
	 *  @default  auto
	 *  @static
	 */
	rowHeight: "auto",

	/**
	 * When using server-side processing, Scroller will wait a small amount of time to allow
	 * the scrolling to finish before requesting more data from the server. This prevents
	 * you from DoSing your own server! The wait time can be configured by this parameter.
	 *  @type     int
	 *  @default  200
	 *  @static
	 */
	serverWait: 200
};

Scroller.oDefaults = Scroller.defaults;



/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * Constants
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

/**
 * Scroller version
 *  @type      String
 *  @default   See code
 *  @name      Scroller.version
 *  @static
 */
Scroller.version = "2.0.3";



/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * Initialisation
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

// Attach a listener to the document which listens for DataTables initialisation
// events so we can automatically initialise
$(document).on( 'preInit.dt.dtscroller', function (e, settings) {
	if ( e.namespace !== 'dt' ) {
		return;
	}

	var init = settings.oInit.scroller;
	var defaults = DataTable.defaults.scroller;

	if ( init || defaults ) {
		var opts = $.extend( {}, init, defaults );

		if ( init !== false ) {
			new Scroller( settings, opts  );
		}
	}
} );


// Attach Scroller to DataTables so it can be accessed as an 'extra'
$.fn.dataTable.Scroller = Scroller;
$.fn.DataTable.Scroller = Scroller;


// DataTables 1.10 API method aliases
var Api = $.fn.dataTable.Api;

Api.register( 'scroller()', function () {
	return this;
} );

// Undocumented and deprecated - is it actually useful at all?
Api.register( 'scroller().rowToPixels()', function ( rowIdx, intParse, virtual ) {
	var ctx = this.context;

	if ( ctx.length && ctx[0].oScroller ) {
		return ctx[0].oScroller.rowToPixels( rowIdx, intParse, virtual );
	}
	// undefined
} );

// Undocumented and deprecated - is it actually useful at all?
Api.register( 'scroller().pixelsToRow()', function ( pixels, intParse, virtual ) {
	var ctx = this.context;

	if ( ctx.length && ctx[0].oScroller ) {
		return ctx[0].oScroller.pixelsToRow( pixels, intParse, virtual );
	}
	// undefined
} );

// `scroller().scrollToRow()` is undocumented and deprecated. Use `scroller.toPosition()
Api.register( ['scroller().scrollToRow()', 'scroller.toPosition()'], function ( idx, ani ) {
	this.iterator( 'table', function ( ctx ) {
		if ( ctx.oScroller ) {
			ctx.oScroller.scrollToRow( idx, ani );
		}
	} );

	return this;
} );

Api.register( 'row().scrollTo()', function ( ani ) {
	var that = this;

	this.iterator( 'row', function ( ctx, rowIdx ) {
		if ( ctx.oScroller ) {
			var displayIdx = that
				.rows( { order: 'applied', search: 'applied' } )
				.indexes()
				.indexOf( rowIdx );

			ctx.oScroller.scrollToRow( displayIdx, ani );
		}
	} );

	return this;
} );

Api.register( 'scroller.measure()', function ( redraw ) {
	this.iterator( 'table', function ( ctx ) {
		if ( ctx.oScroller ) {
			ctx.oScroller.measure( redraw );
		}
	} );

	return this;
} );

Api.register( 'scroller.page()', function() {
	var ctx = this.context;

	if ( ctx.length && ctx[0].oScroller ) {
		return ctx[0].oScroller.pageInfo();
	}
	// undefined
} );

return Scroller;
}));
